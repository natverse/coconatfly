<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Experimental package to enable comparative connectomics analysis of
    multiple Drosophila connectomics datasets, including some private ones still
    under development.">
<title>Comparative Connectomics of Public and In Progress Drosophila Datasets • coconatfly</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Comparative Connectomics of Public and In Progress Drosophila Datasets">
<meta property="og:description" content="Experimental package to enable comparative connectomics analysis of
    multiple Drosophila connectomics datasets, including some private ones still
    under development.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">coconatfly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/flyconnectome/coconatfly/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p><img src="reference/figures/coconatfly-200.jpg" align="right" height="200"></p>
<div class="section level1">
<div class="page-header"><h1 id="coconatfly">coconatfly<a class="anchor" aria-label="anchor" href="#coconatfly"></a>
</h1></div>
<!-- badges: start -->
<p><strong>coconatfly</strong> enables comparative/integrative connectomics across Drosophila datasets. The philosophy is to provide access to the most important functions for connectome analysis in a way that is both convenient and uniform across Drosophila datasets. The package builds upon the <a href="https://natverse.org/coconat/" class="external-link">coconat</a> package which provides more basic and/or dataset agnostic functionality. In case you were wondering, <strong>coconat</strong> stands for COmparative COnnectomics for the NATverse and <strong>coconatfly</strong> enables this specifically for fly datasets.</p>
<p>Although the code is already in active use, especially for comparison of the hemibrain and flywire datasets, it remains experimental. Therefore the interface should not yet been relied upon. In particular, it is quite likely that refactoring will abstract more functionality into <a href="https://natverse.org/coconat/" class="external-link">coconat</a> as time goes by in order to enable more core functionality to be reused.</p>
<div class="section level2">
<h2 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h2>
<p>At present the following datasets are supported (dataset names used in the package in brackets):</p>
<ol style="list-style-type: decimal">
<li>Janelia hemibrain (<strong>hemibrain</strong>)</li>
<li>Female Adult Fly Brain - <a href="https://flywire.ai/" class="external-link">FlyWire connectome</a> (<strong>flywire</strong>)</li>
<li>
<a href="https://www.janelia.org/project-team/flyem/manc-connectome" class="external-link">Janelia male Ventral Nerve Cord</a> (<strong>manc</strong>)</li>
<li>Wei Lee, John Tuthill and colleagues <a href="https://github.com/htem/FANC_auto_recon" class="external-link">Female Adult Nerve Cord</a> (<strong>fanc</strong>)</li>
<li>Janelia Male CNS (<strong>malecns</strong>)</li>
</ol>
<p>The first four datasets are either public (hemibrain, manc) or access can be requested subject to agreeing to certain terms of use (flywire, fanc). The Male CNS dataset is currently in the early stages of proofreading and annotation in a collaboration between the <a href="https://www.janelia.org/project-team/flyem" class="external-link">FlyEM</a> and <a href="https://flyconnecto.me" class="external-link">Cambridge Drosophila Connectomics Group</a>. Release is anticipated early 2024.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of coconatfly like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'natmanager'</span><span class="op">)</span></span>
<span><span class="fu">natmanager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span>pkgs <span class="op">=</span> <span class="st">'coconatfly'</span><span class="op">)</span></span></code></pre></div>
<p>Some of the datasets exposed by <em>coconatfly</em> require authentication for access or are still being annotated in private pre-release. Please consult individual package dependencies for authentication details and do not be surprised if you do not have access to all datasets at this time.</p>
<p>For installation of private packages (currently restricted to the male cns dataset being developed with our collaborators at the <a href="https://www.janelia.org/project-team/flyem" class="external-link">FlyEM Team at Janelia</a>) you will need a GITHUB_PAT (Personal Access Token - an alternative to a username+password).</p>
<p>This code checks if you have a PAT GITHUB_PAT and offers to make one if necessary.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">natmanager</span><span class="fu">::</span><span class="fu">check_pat</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="an-example">An example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h2>
<p>First let’s load the libraries we need</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flyconnectome/coconatfly" class="external-link">coconatfly</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Two important functions are <code><a href="reference/cf_ids.html">cf_ids()</a></code> which allows you to specify a set of neurons from one or more datasets and <code><a href="reference/cf_meta.html">cf_meta()</a></code> which fetches information about the cell type. For example let’s fetch information about DA1 projection neurons:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cf_meta.html">cf_meta</a></span><span class="op">(</span><span class="fu"><a href="reference/cf_ids.html">cf_ids</a></span><span class="op">(</span><span class="st">'DA1_lPN'</span>, datasets <span class="op">=</span> <span class="st">'hemibrain'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           id pre post upstream downstream status    statusLabel     voxels</span></span>
<span><span class="co">#&gt; 1 1734350788 621 2084     2084       4903 Traced Roughly traced 1174705998</span></span>
<span><span class="co">#&gt; 2 1734350908 725 2317     2317       5846 Traced Roughly traced 1382228240</span></span>
<span><span class="co">#&gt; 3 1765040289 702 2398     2398       5521 Traced Roughly traced 1380855164</span></span>
<span><span class="co">#&gt; 4 5813039315 691 2263     2263       5577 Traced Roughly traced 1016515847</span></span>
<span><span class="co">#&gt; 5  722817260 701 2435     2435       5635 Traced Roughly traced 1104413432</span></span>
<span><span class="co">#&gt; 6  754534424 646 2364     2364       5309 Traced Roughly traced 1265805547</span></span>
<span><span class="co">#&gt; 7  754538881 623 2320     2320       4867 Traced Roughly traced 1217284590</span></span>
<span><span class="co">#&gt;   cropped  instance    type cellBodyFiber notes  soma side class group</span></span>
<span><span class="co">#&gt; 1   FALSE DA1_lPN_R DA1_lPN         AVM02  &lt;NA&gt;  TRUE    R  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2   FALSE DA1_lPN_R DA1_lPN         AVM02  &lt;NA&gt;  TRUE    R  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3   FALSE DA1_lPN_R DA1_lPN         AVM02  &lt;NA&gt;  TRUE    R  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4   FALSE DA1_lPN_R DA1_lPN         AVM02  &lt;NA&gt; FALSE    R  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5   FALSE DA1_lPN_R DA1_lPN         AVM02  &lt;NA&gt; FALSE    R  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6   FALSE DA1_lPN_R DA1_lPN         AVM02  &lt;NA&gt;  TRUE    R  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7   FALSE DA1_lPN_R DA1_lPN         AVM02  &lt;NA&gt;  TRUE    R  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt;     dataset           key</span></span>
<span><span class="co">#&gt; 1 hemibrain hb:1734350788</span></span>
<span><span class="co">#&gt; 2 hemibrain hb:1734350908</span></span>
<span><span class="co">#&gt; 3 hemibrain hb:1765040289</span></span>
<span><span class="co">#&gt; 4 hemibrain hb:5813039315</span></span>
<span><span class="co">#&gt; 5 hemibrain  hb:722817260</span></span>
<span><span class="co">#&gt; 6 hemibrain  hb:754534424</span></span>
<span><span class="co">#&gt; 7 hemibrain  hb:754538881</span></span></code></pre></div>
<p>We can also do that for multiple brain datasets</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da1meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cf_meta.html">cf_meta</a></span><span class="op">(</span><span class="fu"><a href="reference/cf_ids.html">cf_ids</a></span><span class="op">(</span><span class="st">'DA1_lPN'</span>, datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'hemibrain'</span>, <span class="st">'flywire'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Updating 2918 ids</span></span>
<span><span class="co">#&gt; flywire_rootid_cached: Looking up 2918 missing keys</span></span>
<span><span class="co">#&gt; Updating 12286 ids</span></span>
<span><span class="co">#&gt; flywire_rootid_cached: Looking up 12285 missing keys</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">da1meta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   id side   class    type group  instance dataset</span></span>
<span><span class="co">#&gt; 1 720575940604407468    R central DA1_lPN  &lt;NA&gt; DA1_lPN_R flywire</span></span>
<span><span class="co">#&gt; 2 720575940623543881    R central DA1_lPN  &lt;NA&gt; DA1_lPN_R flywire</span></span>
<span><span class="co">#&gt; 3 720575940637469254    R central DA1_lPN  &lt;NA&gt; DA1_lPN_R flywire</span></span>
<span><span class="co">#&gt; 4 720575940614309535    L central DA1_lPN  &lt;NA&gt; DA1_lPN_L flywire</span></span>
<span><span class="co">#&gt; 5 720575940617229632    R central DA1_lPN  &lt;NA&gt; DA1_lPN_R flywire</span></span>
<span><span class="co">#&gt; 6 720575940619385765    L central DA1_lPN  &lt;NA&gt; DA1_lPN_L flywire</span></span>
<span><span class="co">#&gt;                     key</span></span>
<span><span class="co">#&gt; 1 fw:720575940604407468</span></span>
<span><span class="co">#&gt; 2 fw:720575940623543881</span></span>
<span><span class="co">#&gt; 3 fw:720575940637469254</span></span>
<span><span class="co">#&gt; 4 fw:720575940614309535</span></span>
<span><span class="co">#&gt; 5 fw:720575940617229632</span></span>
<span><span class="co">#&gt; 6 fw:720575940619385765</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da1meta</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">side</span><span class="op">)</span></span>
<span><span class="co">#&gt;     dataset side n</span></span>
<span><span class="co">#&gt; 1   flywire    L 8</span></span>
<span><span class="co">#&gt; 2   flywire    R 7</span></span>
<span><span class="co">#&gt; 3 hemibrain    R 7</span></span></code></pre></div>
<p>We can also fetch connectivity for these neurons:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da1ds</span> <span class="op">&lt;-</span> <span class="va">da1meta</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/cf_partners.html">cf_partners</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">5</span>, partners <span class="op">=</span> <span class="st">'output'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">da1ds</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 8</span></span>
<span><span class="co">#&gt;    pre_id post_id weight side  type    dataset pre_key               post_key   </span></span>
<span><span class="co">#&gt;   &lt;int64&gt; &lt;int64&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                 &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1    7e17    7e17     64 L     DA1_vPN flywire fw:720575940605102694 fw:7205759…</span></span>
<span><span class="co">#&gt; 2    7e17    7e17     50 L     &lt;NA&gt;    flywire fw:720575940603231916 fw:7205759…</span></span>
<span><span class="co">#&gt; 3    7e17    7e17     49 R     LHAV4a4 flywire fw:720575940604407468 fw:7205759…</span></span>
<span><span class="co">#&gt; 4    7e17    7e17     48 R     DA1_vPN flywire fw:720575940623303108 fw:7205759…</span></span>
<span><span class="co">#&gt; 5    7e17    7e17     46 L     v2LN30  flywire fw:720575940603231916 fw:7205759…</span></span>
<span><span class="co">#&gt; 6    7e17    7e17     42 L     DA1_vPN flywire fw:720575940603231916 fw:7205759…</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da1ds</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">dataset</span>, <span class="va">side</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, npre<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">pre_id</span><span class="op">)</span>, npost<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">post_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'type', 'dataset'. You can override using</span></span>
<span><span class="co">#&gt; the `.groups` argument.</span></span>
<span><span class="co">#&gt; # A tibble: 256 × 6</span></span>
<span><span class="co">#&gt; # Groups:   type, dataset [209]</span></span>
<span><span class="co">#&gt;    type            dataset   side  weight  npre npost</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 AL-AST1         flywire   L         16     2     1</span></span>
<span><span class="co">#&gt;  2 AL-AST1         flywire   R         13     2     1</span></span>
<span><span class="co">#&gt;  3 AL-AST1         hemibrain R         25     3     1</span></span>
<span><span class="co">#&gt;  4 APL             flywire   L         28     4     1</span></span>
<span><span class="co">#&gt;  5 APL             flywire   R         70     6     1</span></span>
<span><span class="co">#&gt;  6 APL             hemibrain R        113     6     1</span></span>
<span><span class="co">#&gt;  7 AVLP010         flywire   L          6     1     1</span></span>
<span><span class="co">#&gt;  8 AVLP010         flywire   R         83     6     1</span></span>
<span><span class="co">#&gt;  9 AVLP011,AVLP012 flywire   L          6     1     1</span></span>
<span><span class="co">#&gt; 10 AVLP011,AVLP012 flywire   R         22     2     1</span></span>
<span><span class="co">#&gt; # ℹ 246 more rows</span></span></code></pre></div>
<p>Let’s restrict that to types that are observed in both datasets. We do this by counting how many distinct datasets exist for each type in the results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da1ds.shared_types.wide</span> <span class="op">&lt;-</span> <span class="va">da1ds</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">dataset</span><span class="op">==</span><span class="st">'hemibrain'</span> <span class="op">&amp;</span> <span class="va">side</span><span class="op">==</span><span class="st">'L'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="co"># drop truncated hemibrain LHS </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>datasets_type<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">datasets_type</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">dataset</span>, <span class="va">side</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>shortdataset<span class="op">=</span><span class="fu"><a href="reference/abbreviate_datasets.html">abbreviate_datasets</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">type</span>, names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">shortdataset</span>,<span class="va">side</span><span class="op">)</span>, </span>
<span>                     values_from <span class="op">=</span> <span class="va">weight</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'type', 'dataset'. You can override using</span></span>
<span><span class="co">#&gt; the `.groups` argument.</span></span>
<span><span class="va">da1ds.shared_types.wide</span></span>
<span><span class="co">#&gt; # A tibble: 38 × 4</span></span>
<span><span class="co">#&gt; # Groups:   type [38]</span></span>
<span><span class="co">#&gt;    type      fw_L  fw_R  hb_R</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 AL-AST1     16    13    25</span></span>
<span><span class="co">#&gt;  2 APL         28    70   113</span></span>
<span><span class="co">#&gt;  3 DA1_lPN     45     6    73</span></span>
<span><span class="co">#&gt;  4 DA1_vPN    250   254   333</span></span>
<span><span class="co">#&gt;  5 DNb05        6     0     5</span></span>
<span><span class="co">#&gt;  6 KCg-m     3275  2545  3030</span></span>
<span><span class="co">#&gt;  7 LHAD1g1     62    60    48</span></span>
<span><span class="co">#&gt;  8 LHAV2a3     70   128   154</span></span>
<span><span class="co">#&gt;  9 LHAV2b11    44    77    29</span></span>
<span><span class="co">#&gt; 10 LHAV3k6     19    16     5</span></span>
<span><span class="co">#&gt; # ℹ 28 more rows</span></span></code></pre></div>
<p>With the data organised like this, we can easily compare the connection strengths between the cell types across hemispheres:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">da1ds.shared_types.wide</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span><span class="op">!=</span><span class="st">'KCg-m'</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">fw_L</span>, <span class="va">fw_R</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope<span class="op">=</span><span class="fl">1</span>, linetype<span class="op">=</span><span class="st">'dashed'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-flywire-left-vs-right-1.png" width="100%"></p>
<p>… and across datasets:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da1ds.shared_types.wide</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span><span class="op">!=</span><span class="st">'KCg-m'</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">fw_R</span>, <span class="va">hb_R</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope<span class="op">=</span><span class="fl">1</span>, linetype<span class="op">=</span><span class="st">'dashed'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-flywire-vs-hemibrain-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="across-dataset-connectivity-clustering">Across dataset connectivity clustering<a class="anchor" aria-label="anchor" href="#across-dataset-connectivity-clustering"></a>
</h2>
<p>Being able to fetch shared connectivity in a uniform format is a building block for a range of analyses. For example, we can compare the connectivity of a set of neurons that are believed to constitute the same cell type across multiple datasets. Cosine similarity clustering seems to work very well for this purpose.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/cf_cosine_plot.html">cf_cosine_plot</a></span><span class="op">(</span><span class="fu"><a href="reference/cf_ids.html">cf_ids</a></span><span class="op">(</span><span class="st">'/type:LAL0(08|09|10|42)'</span>, datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flywire"</span>, <span class="st">"hemibrain"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Updating 2918 ids</span></span>
<span><span class="co">#&gt; Updating 12286 ids</span></span>
<span><span class="co">#&gt; Matching types across datasets. Dropping 461/976 output partner types with total weight 8050/23730</span></span>
<span><span class="co">#&gt; Matching types across datasets. Dropping 737/1356 input partner types with total weight 10875/26780</span></span></code></pre></div>
<p><img src="reference/figures/README-lal-cosine-cluster-1.png" width="100%"></p>
<p>Each row (and column) correspond to a single neuron. Rows are labelled by cell type, dataset and hemisphere; due to truncation hemibrain neurons sometimes exist in one hemisphere, sometimes both. Notice that LAL009 and LAL010 neurons from each hemisphere co-cluster together exactly as we would expect for a cell type conserved across brains. In contrast LAL008 and LAL042 are intermingled; we believe that these constitute a single cell type of two cells / hemisphere (i.e. they should not have been split into two cell types in the hemibrain).</p>
<p>You can also see that cells from one hemibrain hemisphere often cluster slightly oddly (e.g. 387687146) - this is likely due to truncation of the axons or dendrites of these cells or a paucity of partners from the left hand side of the hemibrain.</p>
</div>
<div class="section level2">
<h2 id="going-further">Going further<a class="anchor" aria-label="anchor" href="#going-further"></a>
</h2>
<p>We strongly recommend consulting the online manual visible at <a href="https://natverse.org/coconatfly/" class="external-link uri">https://natverse.org/coconatfly/</a>. In particular the vignette(s) listed at <a href="https://natverse.org/coconatfly/articles" class="external-link uri">https://natverse.org/coconatfly/articles</a> provide full code and instructions for a step by step walk through.</p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>Upon publication, please ensure that you appropriately cite all datasets that you use in your analysis. In addition in order to justify continued development of natverse tools in general and coconatfly in particular, we would appreciate two citations for</p>
<ul>
<li>For the natverse: <a href="https://doi.org/10.7554/eLife.53350" class="external-link">Bates et al eLife 2020</a>
</li>
<li>For coconatfly: <a href="https://doi.org/10.1101/2023.06.27.546055" class="external-link">Schlegel et al bioRxiv 2023</a>
</li>
</ul>
<p>Should you make significant use of natverse packages in your paper (e.g. multiple panels or &gt;1 figure), we would also strongly appreciate a statement like this in the acknowledgements that can be tracked by our funders.</p>
<blockquote><p>Development of the natverse including the coconatfly and fafbseg packages has been supported by the NIH BRAIN Initiative (grant 1RF1MH120679-01), NSF/MRC Neuronex2 (NSF 2014862/MC_EX_MR/T046279/1) and core funding from the Medical Research Council (MC_U105188491).</p></blockquote>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/flyconnectome/coconatfly/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/flyconnectome/coconatfly/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing coconatfly</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Gregory Jefferis <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0587-9355" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/natverse/coconatfly/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/natverse/coconatfly/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/natverse/coconatfly?branch=master" class="external-link"><img src="https://codecov.io/gh/natverse/coconatfly/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
