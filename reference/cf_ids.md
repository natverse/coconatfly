# Specify ids for fly connectome datasets

Specify ids for fly connectome datasets

## Usage

``` r
cf_ids(
  query = NULL,
  datasets = c("brain", "vnc", "hemibrain", "flywire", "malecns", "manc", "fanc",
    "opticlobe", "banc", "yakubavnc"),
  expand = TRUE,
  keys = FALSE,
  hemibrain = NULL,
  flywire = NULL,
  malecns = NULL,
  manc = NULL,
  fanc = NULL,
  opticlobe = NULL,
  banc = NULL,
  yakubavnc = NULL,
  ...
)

# S3 method for class 'cidlist'
c(..., unique = TRUE)
```

## Arguments

- query:

  A query (e.g. cell type name or regular expression)

- datasets:

  Character vector naming datasets to which the `query` should be
  applied.

- expand:

  Whether to expand any queries into the matching ids (this will involve
  one or more calls to corresponding servers). Default `TRUE`.

- keys:

  Whether to turn the ids into keys `hb:12345` right away. Default
  `FALSE` but you may find this useful e.g. for combining lists of
  neurons (see examples).

- hemibrain:

  Pass hemibrain specific query or ids to this argument

- flywire:

  Pass flywire specific query or ids to this argument

- malecns:

  Pass malecns specific query or ids to this argument

- manc:

  Pass manc specific query or ids to this argument

- fanc:

  Pass fanc ids to this argument (at present we do not support metadata
  queries for fanc)

- opticlobe:

  Pass opticlobe specific query or ids to this argument

- banc:

  Pass banc ids to this argument (we only support basic metadata queries
  for banc)

- yakubavnc:

  Pass yakuba VNC specific query or ids to this argument

- ...:

  One or more lists generated by `cf_ids` that should be joined together

- unique:

  Whether to remove duplicated ids when combining cf_id lists with
  `c.cidlist`

## Value

A list of ids with additional class `cidlist`

## Details

You will often want to perform a query, most commonly for a cell *type*
or cell *class*, rather than specific numeric ids. The most flexible way
to do this is to use a regular expression (regex) query, specified with
an initial `"/"`.

All neuprint datasets (hemibrain, malevnc, opticlobe, malecns) use the
same query syntax although some fields may be dataset specific (see
examples). The regex syntax for CAVE datasets (flywire, fanc, banc)
should be the same although you may find some wrinkles because the
underlying data stores are different. Note that we do not yet translate
all the different fields across datasets for queries, although this is a
goal. For example the neuprint/fanc/banc `class` field is equivalent to
flywire `super_class`. Similarly the values are not guaranteed to be the
same. Where flywire uses `super_class=="descending")` the manc uses
`class=="descending neuron")`.

Therefore to find all DNs in these two datasets you will need to do:
`cf_ids(manc='/class:descending.*', flywire='/super_class:descending.*')`

Feel free to [make an
issue](https://github.com/natverse/coconatfly/issues) if you find
something that doesn't feel right or can suggest an improvement.

## Additional datasets

coconatfly allows can be extended by registering additional datasets
using the
`coconat::`[`register_dataset`](https://natverse.org/coconat/reference/register_dataset.html)
function. You can use `cf_ids` to support these additional datasets by
passing additional named arguments. The only inconvenience is that these
will not be available for command completion by your editor.

## See also

Other ids: [`keys()`](https://natverse.org/coconatfly/reference/keys.md)

## Examples

``` r
# \donttest{
cf_ids("DA2_lPN", datasets='brain')
#> Using malecns dataset `male-cns:v0.9`.
#> See ?malecns section Package Options for details.
#> Error: In expand_ids: Unable to process query for dataset: `banc`. Details:
#> Error: To use the banc dataset please do `natmanager::install(pkgs = 'flyconnectome/bancr')` 
#> TRUE
# / introduces a regular expression
cf_ids("/MBON.+", datasets='brain')
#> Error: In expand_ids: Unable to process query for dataset: `flywire`. Details:
#> Error in flytable_cell_types(pattern = x, target = target, version = version, : Malformed regex query:`/MBON.+`! Should look like `/<field>:<regex`
#> TRUE

# expand query into actual ids
cf_ids("/type:MBON.+", datasets='brain', expand=TRUE)
#> Error: In expand_ids: Unable to process query for dataset: `banc`. Details:
#> Error: To use the banc dataset please do `natmanager::install(pkgs = 'flyconnectome/bancr')` 
#> TRUE

# return keys directly
cf_ids("/type:MBON.+", keys=TRUE)
#> Error: In expand_ids: Unable to process query for dataset: `banc`. Details:
#> Error: To use the banc dataset please do `natmanager::install(pkgs = 'flyconnectome/bancr')` 
#> TRUE
# one way of combining separate lists of neurons
hbids=c(264083994, 5813022274)
c(cf_ids("/type:MBON1.+", keys=TRUE), cf_ids(hemibrain = hbids, keys = TRUE))
#> Error: In expand_ids: Unable to process query for dataset: `banc`. Details:
#> Error: To use the banc dataset please do `natmanager::install(pkgs = 'flyconnectome/bancr')` 
#> TRUE

# now equivalent to
keys(c(cf_ids("/type:MBON1.+"), cf_ids(hemibrain = hbids)))
#> Error: In expand_ids: Unable to process query for dataset: `banc`. Details:
#> Error: To use the banc dataset please do `natmanager::install(pkgs = 'flyconnectome/bancr')` 
#> TRUE

# queries on classes respecting dataset idiosyncrasies
cf_ids(manc="/class:descend.+", flywire="/super_class:descend.+", expand = TRUE)
#> flywire [1303 ids]: 720575940624402173 720575940627055303 720575940631082808 720575940623037720 720575940629543409 720575940618666142 720575940638109668 720575940630697078 720575940610610841 720575940618870881 ...
#> manc [1322 ids]: 28478 31361 156265 19821 22072 24087 29182 30346 31742 33545 ...
# }
c(cf_ids(flywire = 1, hemibrain = 2), cf_ids(hemibrain = 1:2, flywire=1:2))
#> flywire [2 ids]: 1 2
#> hemibrain [2 ids]: 2 1
c(cf_ids(flywire = 1, hemibrain = 2), cf_ids(hemibrain = 1:2, flywire=1:2), unique=FALSE)
#> flywire [3 ids]: 1 1 2
#> hemibrain [3 ids]: 2 1 2
# \donttest{
c(cf_ids(flywire = 1, hemibrain = 2), cf_ids(hemibrain = '/SMP55[0-9]', flywire=1:2))
#> flywire [2 ids]: 1 2
#> hemibrain [19 ids]: 2 452689494 579700707 328274638 392757094 605166418 298262663 361114148 669670654 613394707 ...
# }
```
